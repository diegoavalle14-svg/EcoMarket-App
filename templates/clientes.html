<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EcoMarket - Sistema de Clientes</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
/* ======== CSS EXISTENTE ======== */
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family: 'Poppins', Arial, sans-serif;
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    color: #2e7d32;
    padding: 10px 50px;
}
.header {
    text-align: center;
    background: linear-gradient(90deg,#165c19,#43a047);
    color:white;
    padding: 20px 20px;
    border-radius: 30px;
    margin-bottom: 40px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.25);
}
.header h1 { font-size: 4.5em; font-weight: 800; text-shadow: 2px 3px 6px rgba(0,0,0,0.25); }
.header p { margin-top: 10px; font-size: 1.2em; font-weight: 500; }
.container { max-width: 1200px; margin: 0 auto; }
.content { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }
.form-section, .table-section { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(76,175,80,0.2); }
h2 { color: #2e7d32; margin-bottom: 20px; font-size: 1.8em; }
.form-group { margin-bottom: 15px; }
label { display: block; margin-bottom: 5px; font-weight: 600; }
input { width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #c8e6c9; font-size: 1em; }
input:focus { outline: none; border-color: #43a047; }
.btn { padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
.btn-primary { background: linear-gradient(90deg,#43a047,#66bb6a); color:white; }
.btn-primary:hover { background: linear-gradient(90deg,#388e3c,#43a047); }
.btn-secondary { background: #6c757d; color:white; }
.btn-secondary:hover { background: #5a6268; }
table { width: 100%; border-collapse: collapse; }
thead { background: #43a047; color: white; }
th, td { padding: 12px; border-bottom: 1px solid #c8e6c9; text-align:center; }
tbody tr:hover { background: #f1f8f1; }
.action-btn { padding: 6px 12px; margin: 0 3px; border-radius: 6px; font-size: 0.9em; cursor: pointer; }
.edit-btn { background: #ffc107; color:#333; }
.edit-btn:hover { background: #ffb300; }
.delete-btn { background: #dc3545; color:white; }
.delete-btn:hover { background: #c82333; }
.alert { padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none; }
.alert-success { background: #d4edda; color: #155724; border:1px solid #c3e6cb; }
.alert-error { background: #f8d7da; color: #721c24; border:1px solid #f5c6cb; }
.stats { display: flex; gap: 20px; margin-bottom: 20px; }
.stat-card { flex:1; background:white; padding:20px; border-radius:15px; box-shadow:0 5px 20px rgba(76,175,80,0.15); text-align:center; }
.stat-card h3 { font-size:1.5em; margin-bottom:10px; color:#2e7d32; }
.stat-card p { font-size:1.2em; color:#555; }
@media (max-width: 900px){ .content { grid-template-columns: 1fr; } .stats{ flex-direction:column; } }
</style>
</head>
<body>

<div class="header">
    <h1>EcoMarket</h1>
    <p>Sistema de Gesti√≥n de Clientes</p>
        <!-- Bot√≥n men√∫ principal -->
    <div style="text-align:center; margin-top:30px;">
        <a class="btn btn-primary" href="/menu" style="padding:14px 20px; border-radius:14px; text-decoration:none; font-weight:600;">
            Volver al Men√∫ Principal
        </a>
    </div>
</div>

<div class="container">

    <!-- Estad√≠sticas r√°pidas -->
    <div class="stats">
        <div class="stat-card">
            <h3>{{ clients|length if clients else 0 }}</h3>
            <p>Total de Clientes</p>
        </div>
        <div class="stat-card">
            <h3>‚úîÔ∏è</h3>
            <p>Clientes Activos</p>
        </div>
        <div class="stat-card">
            <h3>üìã</h3>
            <p>Registros Recientes</p>
        </div>
    </div>

    <div class="content">

        <!-- Formulario de clientes -->
        <div class="form-section">
            <h2 id="form-title">‚ûï Nuevo Cliente</h2>
            <div class="alert alert-success" id="success-alert"></div>
            <div class="alert alert-error" id="error-alert"></div>

            <form id="client-form">
                <input type="hidden" id="client-id">
                <div class="form-group">
                    <label for="nombre">Nombre *</label>
                    <input type="text" id="nombre" required>
                </div>
                <div class="form-group">
                    <label for="apellido">Apellido *</label>
                    <input type="text" id="apellido" required>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email">
                </div>
                <div class="form-group">
                    <label for="telefono">Tel√©fono</label>
                    <input type="tel" id="telefono">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary" id="submit-btn">Guardar</button>
                    <button type="button" class="btn btn-secondary" id="cancel-btn" style="display:none;">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- Tabla de clientes -->
        <div class="table-section">
            <h2>üìã Lista de Clientes</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Email</th>
                        <th>Tel√©fono</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="clients-tbody">
                    {% if clients %}
                        {% for client in clients %}
                        <tr>
                            <td>{{ client.id }}</td>
                            <td>{{ client.nombre }}</td>
                            <td>{{ client.apellido }}</td>
                            <td>{{ client.email or '-' }}</td>
                            <td>{{ client.telefono or '-' }}</td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editClient({{ client.id }})">‚úèÔ∏è Editar</button>
                                <button class="action-btn delete-btn" onclick="deleteClient({{ client.id }})">üóëÔ∏è Eliminar</button>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="6" style="text-align:center;">No hay clientes registrados</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>


</div>

<script>
// === JS PARA CRUD ===
const API_URL = '/api/clientes';
let editMode = false;
function resetForm(){
    document.getElementById('client-form').reset();
    document.getElementById('client-id').value = '';
    editMode = false;
    document.getElementById('form-title').textContent = '‚ûï Nuevo Cliente';
    document.getElementById('submit-btn').textContent = 'Guardar';
    document.getElementById('cancel-btn').style.display = 'none';
}
function showSuccess(msg){ const alert = document.getElementById('success-alert'); alert.textContent = msg; alert.style.display = 'block'; setTimeout(()=>{ alert.style.display='none'; }, 3000); }
function showError(msg){ const alert = document.getElementById('error-alert'); alert.textContent = msg; alert.style.display = 'block'; setTimeout(()=>{ alert.style.display='none'; }, 3000); }
document.getElementById('client-form').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const id = document.getElementById('client-id').value;
    const nombre = document.getElementById('nombre').value;
    const apellido = document.getElementById('apellido').value;
    const email = document.getElementById('email').value;
    const telefono = document.getElementById('telefono').value;
    const formData = new FormData();
    formData.append('nombre', nombre);
    formData.append('apellido', apellido);
    formData.append('email', email);
    formData.append('telefono', telefono);
    try {
        let url = API_URL;
        let method = 'POST';
        if(editMode){ url = `${API_URL}/${id}`; method='PUT'; }
        const res = await fetch(url, { method, body: formData });
        if(res.ok){ showSuccess(editMode ? 'Cliente actualizado':'Cliente agregado'); resetForm(); location.reload(); }
        else{ const data=await res.json(); showError(data.detail||'Error al guardar cliente'); }
    } catch(err){ showError('Error en la conexi√≥n'); }
});
document.getElementById('cancel-btn').addEventListener('click', resetForm);
function editClient(id){ fetch(`${API_URL}/${id}`).then(res=>res.json()).then(client=>{
    document.getElementById('client-id').value=client.id;
    document.getElementById('nombre').value=client.nombre;
    document.getElementById('apellido').value=client.apellido;
    document.getElementById('email').value=client.email||'';
    document.getElementById('telefono').value=client.telefono||'';
    document.getElementById('form-title').textContent='‚úèÔ∏è Editar Cliente';
    document.getElementById('submit-btn').textContent='Actualizar';
    document.getElementById('cancel-btn').style.display='block';
    editMode=true;
}).catch(()=>showError('Error al cargar cliente')); }
function deleteClient(id){ if(!confirm('¬øDesea eliminar este cliente?')) return; fetch(`${API_URL}/${id}`,{method:'DELETE'}).then(res=>{ if(res.ok) location.reload(); else showError('Error al eliminar cliente'); }); }
</script>

</body>
</html>
